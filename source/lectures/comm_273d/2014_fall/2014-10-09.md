---
title: The shapes of maps
date: 2014-10-09
description: A continuation of learning mapping tools, with a focus on borders and shapes
---

Today we discuss more on the theory and practical use cases of mapping, and learn to (superficially) work with shapefile data.

Next week, when we are deep in the soul-crushing debugging of Structured Query Language, think of shape-mapping, particularly where borders intersect and overlap, as a visual representation of "inner" and "outer" joins. 

__Related tutorial__: [Fusion Tables Intensity Maps with Custom Shapes](/tutorials/mapping/fusion-table-shapes/)

### Voronoi cholera map

Continuing from [last lesson's mention of John Snow](/2014-10-07)...

Below is an interactive version of John Snow's cholera map. The red dots represent the casualties, the orange dots represent the pumps.

The shaded region around each pump represents the _area_ in which that pump is the _closest_ to, _as the crow flies_. Thus, the red dots within each pump's shaded region represent the casualties that were nearer to that pump than to the neighboring pump.

This is a [simple Voronoi diagram](http://en.wikipedia.org/wiki/Voronoi_diagram) to help better quantify the deaths of people whose main water source was the Broad Street pump.

__Technical note:__ There are a few technical problems with this map, particularly my poor implementation of the [D3 voronoi function](http://bl.ocks.org/mbostock/4060366) and how the "deaths" were geocoded (the stacked dots all belong to a particular building/geopoint)...but it's meant to be a rough demonstration of the voronoi concept.

<!-- begin embedded html stuff here. TODO: include d3 as part of application -->

<style>
 #snow-map{
    border: thin solid #998; 
    height: 900px; 
    width: 900px;
    margin-left: auto;
    margin-right: auto;
  }
  .d3-tip{
    background: #333;
    color: white;
    font-size: 13px;
    line-height: 1.6;
    padding: 5px;
  }
</style>
<script src="/files/lectures/2014-10-09/john-snow-voronoi/js/d3.v3.js"></script>
<script src="/files/lectures/2014-10-09/john-snow-voronoi/js/d3.tip.js"></script>
<div id="snow-map"></div>

<script src="/files/lectures/2014-10-09/john-snow-voronoi/js/snow.map.js"></script>

__More technical notes:__ The digitized death point data comes from [Rusty Dodson of NCGIA/Santa Barbara](http://www.ncgia.ucsb.edu/pubs/snow/snow.html). The code to draw the map was [inspired by Waldo Tobler's work here](http://ncgia.ucsb.edu/Publications/Software/cholera/). The Voronoi-drawing code is a crude alteration of [Mike Bostock's demonstration](http://bl.ocks.org/mbostock/4060366).



### John Snow's hand-drawn Voronoi diagram

The voronoi-map diagram helps with visualizing each pump's "region of influence", but drawing the boundaries based on as-the-crow-flies distance misses an important nuance: lugging water containers, whether by hand or by wheeled-cart, cannot be done as if you were a bird. In other words, people will gravitate to a water pump in which the _roads_ (or walkways) to get there are more convenient, even if the crows-flies distance is farther.

This was a nuance that Dr. Snow captured in this lesser-known version of his cholera map (which is considered a voronoi-type diagram, even though such a concept wasn't invented in Snow's time). 

Via Stephen Johnson in ["The Ghost Map: The Story of London's Most Terrifying Epidemic"](http://www.amazon.com/The-Ghost-Map-Terrifying-Epidemic/dp/1594482691):

> After presenting to the Epidemiological Society, Snow had realized that his original map was still vulnerable to a miasmatic interpretation. Perhaps the concentration of deaths around the Broad Street pump was merely evidence that the pump was releasing noxious fumes into the air. And so Snow realized he needed a way to represent graphically the foot-traffic activity around the pump that he had so painstakingly reconstructed. He needed to show lives, not just deaths; he needed to show the way the neighborhood was actually traversed by its residents.

via the [John Snow archive](http://johnsnow.matrix.msu.edu/book_images12.php):

![img](/files/lectures/2014-10-09/voronoi-snow.jpg)

The key takeaway is that the raw geographic data &ndash; location of the pumps, location of the dead residents &ndash; was not enough to make a scientific argument. Snow had to _understand how the dead lived_: the hand-drawn loop around the Broad Street pump is based off of his understanding of the traffic patterns at the human level, giving a more precise illustration of how people accessed the Broad Street pump.

And while the deaths inside the boundary line are interesting, if not conclusive evidence, the boundary line also makes it easy to identify __counterexamples__, i.e. anomalies that seem to contradict Dr. Snow's hypothesis.

These counterexamples underscore the strength of Dr. Snow's reporting and scientific method. There are at least two kinds "counterexamples" that are interesting:

1. There are several buildings _within_ the voronoi-boundary that have strikingly _few_ deaths. Dr. Snow investigated these individually. An example from [Tufte's retrospective analysis](http://www.edwardtufte.com/tufte/books_textb):

   > There is a brewer in Broad Street, near the pump, and on perceiving that no brewer's men were registered as having died of cholera, I called on Mr. Huggins, the propietor. He informed me that there were above seventy workmen employed in the brewery, and that none of them had suffered from cholera, at least in a severe form...The men are allowed a certain quantity of malt liquor, and Mr. Huggins believes they do not drink water at all...There is a deep well in the brewery, in addition to the New River water.
  
2. There are clusters of deaths that are _far from the Broad Street pump_. In his investigation, Dr. Snow found that many residents willingly traveled a farther distance to the Broad Street pump because it was thought to have better-quality water. 

So to continue hammering on the point: __it's not the visualization, it's the reporting__.


### Near/inside a shape: Earthquakes and schools

via Center for Investigative Reporting: [Palo Alto schools near seismic hazards](http://seismic.apps.cironline.org/county/santa-clara/city/palo-alto/fullscreen/)

A good example of "joining" data: The shapefiles that represent the quicksand zones and fault lines are one dataset. The locations of schools are another dataset. Where the two intersect: that may be a story.

![img](files/lectures/2014-10-09/cir-on-shaky-ground-palo-alto.png)



### Outside a shape: Campaign contributions outside a district

via WNYC's John Keefe:

[The 54th Assembly campaign contribution breakdown: Where have all the in-district donors gone?
](http://www.wnyc.org/story/195868-the-54th-assembly-campaign-contribution-breakdown-where-have-all-the-in-district/)

> Still, no one can really claim to be pulling their support--at least financially--directly from the people they represent.

![img](/files/lectures/2014-10-09/wnyc-donations-district54-in-or-out.png)



### Illustrative maps 

In U.S. presidential elections, the most common way to show election results is via a state-by-state voting map. [Via the NYT](http://elections.nytimes.com/2012/results/president):

![img](/files/lectures/2014-10-09/nyt-elections-map.png)

Reflect on why this map _just works_: if you're a long-time U.S. resident, you have a decent fix for what these _shapes_ represent. In many cases, such as with "Florida", you're able to find it on this map much faster than you would in a standard list/table.

However, if you were completely unfamiliar with U.S. geography, this map would seem to illustrate an incredibly close political race, one in which "Red" seems to have _won_. And that's because without prior political knowledge, this kind of map ends up being not a map of political votes, but of _geographic area_, such that states like Montana and Ohio have an outsized/undersized visual impact.

To underscore this point, [look at the vote tally by _county_](http://commons.wikimedia.org/wiki/File:2012nationwidecountymapshadedbypercentagewon.svg): unless you have an impressive memorization of county-level demographics, this map very strongly conveys the impression of a Republican victory:

![wikipedia](http://upload.wikimedia.org/wikipedia/commons/thumb/a/ab/2012nationwidecountymapshadedbypercentagewon.svg/473px-2012nationwidecountymapshadedbypercentagewon.svg.png)

#### Cartogram

The [cartogram](http://en.wikipedia.org/wiki/Cartogram) is one kind of compromise to deal with the _population-vs-geography_ mismatch. In the map below,[ each electoral vote is given the same size](http://en.wikipedia.org/wiki/File:Cartogram%E2%80%942012_Electoral_Vote.svg), and then placed _roughly_ where it corresponds in relative geography. The tradeoff is that, well, it's not as easy to reflexively locate many of the less-influential states, such as Iowa:

![img](http://upload.wikimedia.org/wikipedia/commons/thumb/0/0d/Cartogram%E2%80%942012_Electoral_Vote.svg/762px-Cartogram%E2%80%942012_Electoral_Vote.svg.png)


#### Illustrative policy map: gun permit policies

Here's a non-election way of using the U.S. map to quickly show the state of state laws:


NYT Graphic: [Easing Restrictions on Gun Permits](http://www.nytimes.com/interactive/2011/12/27/us/easing-restrictions-on-gun-permits.html?ref=us)

![img](/files/lectures/2014-10-07/nyt-map-easing-restrictions-gun-permits.png)


via [Michael Luo of the New York Times](http://topics.nytimes.com/top/reference/timestopics/people/l/michael_luo/index.html?inline=nyt-per):

- [Guns in Public, and Out of Sight](http://www.nytimes.com/2011/12/27/us/more-concealed-guns-and-some-are-in-the-wrong-hands.html)
- [Felons Finding It Easy to Regain Gun Rights](http://www.nytimes.com/2011/11/14/us/felons-finding-it-easy-to-regain-gun-rights.html)

NYT Graphic: [Restoring Gun Rights](http://www.nytimes.com/interactive/2011/07/03/us/guns.html?ref=us)

![img](/files/lectures/2014-10-07/nyt-map-restoring-gun-rights.png)



#### Illustrative policy map: failure-to-protect laws

We discussed BuzzFeed reporter [Alex Campbell's investigation into failure-to-protect laws in the previous class](http://www.buzzfeed.com/alexcampbell/how-the-law-turns-battered-women-into-criminals#3wn6ef7). I'm including some notes and discussion here, as it is relevant for today's assignment.

Here's the illustrative U.S. map used in Campbell's story:

![img](/files/lectures/2014-10-09/enhanced-mid-23958-1412110393-1.jpg)

The deeper the red, the harsher the maximum sentence for a failure-to-protect conviction.

This is a decent example of using the U.S. map to illustrate the spread of policy, but I highlight this story's map in particular because they [include the spreadsheet they use to build it](https://s3.amazonaws.com/buzzfeed-media/Images/2014/09/buzzfeednews_failuretoprotectlaws.pdf). Here's what the sheet's layout looks like (split in half to better fit the page here):

![img](files/lectures/2014-10-09/buzzfeed-failure-to-protect-sheet-1.png)

![img](files/lectures/2014-10-09/buzzfeed-failure-to-protect-sheet-2.png)

Campbell's [investigation also includes this sidebar](http://www.buzzfeed.com/alexcampbell/these-mothers-were-sentenced-to-at-least-10-years-for-failin#3wn6ef7) with how cases were found, and the supporting spreadsheets are included. There's [also a list of the kinds of data BuzzFeed asked for from each state](http://www.buzzfeed.com/alexcampbell/these-mothers-were-sentenced-to-at-least-10-years-for-failin#bfnewsstate).




