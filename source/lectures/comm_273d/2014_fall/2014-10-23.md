---
title: Midterm Malarkey with Military Surplus
date: 2014-10-23
description: A casual midterm covering the range of data analysis and programming skills acquired so far.
---

The notes for this section consist entirely of the description for the dataset used for the midterm, example queries to help you understand the dataset, and then a few questions for you to tackle on your own.

Everything covered here has been covered in the [tutorials](/tutorials), though you'll probably want to make sure you have a good understanding of [LEFT joins](/tutorials/database-joins/sql-left-joins/) and [many-to-one-relationships](/tutorials/database-joins/sql-many-to-one/).

__Update__: Here [are the answers](/pages/midterm-answers)



### Previous homework

Regarding the time-series (or [histogram](http://en.wikipedia.org/wiki/Histogram)) chart, by political party, [of Congressmembers and the number of Tweets mentioning "ebola"](/2014-10-23#homework-details) as of October 20, 2014.

Using the [MySQL dump](http://stash.padjo.org/dumps/sql/congress_twitter.sql.zip) or [SQLite dump](http://stash.padjo.org/dumps/sql/congress_twitter.sqlite.zip) of  of Congress and Twitter data, run this query to find _every_ tweet mentioning "ebola" and selecting the relevant fields:

~~~sql
SELECT 
    members.first_name, members.last_name, 
    members.party, members.current_role, members.state,
    social_accounts.twitter_screen_name,
    tweets.text, DATE(tweets.created_at) as tweet_date
  FROM members
  JOIN social_accounts
    ON members.bioguide_id = social_accounts.bioguide_id
  JOIN tweets
    ON social_accounts.twitter_screen_name = tweets.screen_name
  WHERE
    tweets.text LIKE '%ebola%'
  ORDER BY tweet_date
~~~

The result is __811__ tweets, which [I've uploaded to this Google Spreadsheet](https://docs.google.com/a/stanford.edu/spreadsheets/d/1gjTMRs1gAAfgKU36jsgO9lu803mYpJ2ZLArgdhQEEr0/edit#gid=0). From here, it's just adding some derived date columns [and doing a pivot table](https://docs.google.com/a/stanford.edu/spreadsheets/d/1gjTMRs1gAAfgKU36jsgO9lu803mYpJ2ZLArgdhQEEr0/edit#gid=1370269756).

I've made a couple of editorial choices: the database contains only 2 tweets (both by Democrats) in the year 2013, and only 2 tweets by an Independent. The outliers would skew the chart (i.e. create a lot of empty space) so I've filtered them out, so that the chart only shows __2014__ tweets by Democrats and Republicans.

Along the x-axis, I've chosen to do the __week number__ (which can be found using Google Spreadsheet's `WEEKNUM` function, or MySQL's `WEEK` function) derived from each tweet's `created_at` value.

The resulting chart:

![ebola chart](/files/lectures/2014-10-23/ebola-tweets-chart.png)


Note: Alternatively, if you wanted to reduce the amount of Pivot Table work, you could've done the aggregations inside of SQL.

For MySQL:

~~~sql
SELECT 
    members.party, 
    WEEK(tweets.created_at) AS tweet_week,
    YEAR(tweets.created_at) AS tweet_year,
    COUNT(*) AS tweet_count
  FROM members
  JOIN social_accounts
    ON members.bioguide_id = social_accounts.bioguide_id
  JOIN tweets
    ON social_accounts.twitter_screen_name = tweets.screen_name
  WHERE
    tweets.text LIKE '%ebola%'
  GROUP BY party, tweet_year, tweet_week
  ORDER BY party, tweet_year, tweet_week
~~~

For SQLite ([remember the list of format strings](https://www.sqlite.org/lang_datefunc.html) for the `strftime` function?):

~~~sql
SELECT 
    members.party, 
    strftime('%W', tweets.created_at) AS tweet_week,
    strftime('%Y', tweets.created_at) AS tweet_year,
    COUNT(*) AS tweet_count
  FROM members
  JOIN social_accounts
    ON members.bioguide_id = social_accounts.bioguide_id
  JOIN tweets
    ON social_accounts.twitter_screen_name = tweets.screen_name
  WHERE
    tweets.text LIKE '%ebola%'
  GROUP BY party, tweet_year, tweet_week
  ORDER BY party, tweet_year, tweet_week

~~~



## Midterm information

The following section is all about the midterm and the data we're using.

### Download the data:

- [SQL](http://stash.padjo.org.s3.amazonaws.com/dumps/sql/leso_273d.sql.zip)
- [SQLite](http://stash.padjo.org.s3.amazonaws.com/dumps/sql/leso_273d.sqlite.zip)

### The 1033 Program


![img Wikipedia](http://upload.wikimedia.org/wikipedia/commons/7/76/Ferguson_Day_6%2C_Picture_44.png)

_Photo courtesy of [Wikipedia user Loavesofbread licensed under Creative Commons Attribution-Share Alike 4.0 International](http://en.wikipedia.org/wiki/File:Ferguson_Day_6,_Picture_44.png)_


The [1033 Program was established](http://www.dispositionservices.dla.mil/leso/pages/default.aspx) to allow the U.S. Defense Dept. to give away its surplus equipment to U.S. law enforcement agencies. More than $5.1 billion of military gear has been distributed to the nearly 8,000 law enforcement agencies who participate in the program.

Congress initially authorized the transfer of military gear for the War on Drugs. The 1033 program was later open to any U.S. law enforcement agency, [though preference is given to requests related to counter-drug and counter-terrorism requests](http://www.dispositionservices.dla.mil/leso/pages/1033programfaqs.aspx).

The program has, of late, come under scrutiny because of photos of heavily-equipped police [during the civil unrest in Ferguson during 2014](http://en.wikipedia.org/wiki/2014_Ferguson_unrest). 

NPR has [some documentation arising from their analysis](https://drive.google.com/folderview?id=0B03IIavLYTovdWg4NGtzSW9wb2c&usp=sharing) of the federal 1033 Program data and statewide data that they've acquired. You may want to read it to figure out what some of the data columns mean.

The California Governor's Office of Emergency Services [has posted a helpful 1033 Program page](http://www.calema.ca.gov/publicsafetyandvictimservices/pages/about-the-1033-program.aspx
) in which you can find links to more background information and data.

MuckRock has been making public records requests for additional data from each state. I haven't included their tables into this midterm, [but their reporting is well-worth reading to understand the issues and context of the 1033 program](https://www.muckrock.com/news/archives/2014/sep/04/we-have-over-half-countrys-agency-agency-1033-data/).

### The five data tables in the midterm database 

- The [SQL](http://stash.padjo.org.s3.amazonaws.com/dumps/sql/leso_273d.sql.zip) version. 
- The [SQLite](http://stash.padjo.org.s3.amazonaws.com/dumps/sql/leso_273d.sqlite.zip) version



- __leso__ - the main table of interest. It contains the list of military surplus items distributed by the 1033 program to law enforcement agencies from __January 2006 to July 2014__. It is derived from the official spreadsheet maintained by the Law Enforcement Support OFfice, [which you can download in Excel format here](https://drive.google.com/file/d/0ByME-GBaHL24c0RKbHhaNktnSTQ/edit?usp=sharing).

- __county_boundaries__ - A list of KML boundary data for every U.S. county, [courtesy of Google](https://support.google.com/fusiontables/answer/1182141?hl=en). See their [Fusion Table here](https://www.google.com/fusiontables/DataSource?docid=0IMZAFCwR-t7jZnVzaW9udGFibGVzOjIxMDIxNw)

- __county_ansi__ - County names and FIPS codes. I've "cleaned" up the `county` field so that it matches the ways counties were (mis)spelled in the `leso` table. [Read more about ANSI and FIPS here](http://www.census.gov/geo/reference/ansi.html).

- __psc__ - A list of Product Service Codes and descriptions, from the Federal Procurement Data System. You may find it useful for browsing the general categories of things that the 1033 program distributes. [Read more about PSCs here](http://www.acquisition.gov/PSC%20Manual%20-%20Final%20-%2011%20August%202011.pdf).

- __census_quickfacts__ - A variety of U.S. Census demographic and population statistics per county. Please read the [DataDict.txt file](http://quickfacts.census.gov/qfd/download/DataDict.txt) provided on the [U.S. Census's overview page](http://quickfacts.census.gov/qfd/download_data.html).



### Making sense of the U.S. Census QuickFacts table

To reiterate: the `census_quickfacts` table is not going to make much sense because the headers are things like `AGE775213` (Persons 65 years and over, percent, 2013) and `RHI725213` (Hispanic or Latino, percent, 2013). __So you must read the__ [Census Quickfacts Data Dictionary](http://quickfacts.census.gov/qfd/download/DataDict.txt) to make sense of it.

##### Technical data munging note
Like every data set we've dealt with so far, the Census and LESO data is what we call, "messy". For example, the original LESO spreadsheet, which I downloaded ([direct link](https://drive.google.com/file/d/0ByME-GBaHL24c0RKbHhaNktnSTQ/edit)) via the [California state site](http://www.calema.ca.gov/publicsafetyandvictimservices/pages/about-the-1033-program.aspx), comprised separate lists divided by alphabetical ordering of the states. So I had to manually copy and paste the sheets together to make one sheet.

The Census QuickFacts table was not in itself "messy"; the problem is that the LESO data only refers to state and county names, in all uppercase, and the LESO data does not follow the ANSI standard, apparently. For example, ["Bristol City, Virginia"](http://quickfacts.census.gov/qfd/states/51/51520.html) is referred in LESO as just "BRISTOL". Whereas "Baltimore city" is correctly keyed as "BALTIMORE CITY". The inconsistencies were without rhyme or reason, leaving me to apply custom queries to fix up at least several hundreds of rows.

The upshot: if you think you have a cool story from this midterm data, don't run with it just yet. We'll want to doublecheck that I didn't mess up my data munging in such a way that it impacts your queries.
 
### Sample queries

Most of the work will involve just inspecting the tables and what they contain. Here are some example queries to demonstrate what's in them.

##### Quick syntax note

When referring to a column that has a _space_ in the name, such as `Item Cost`, you _must_ enclose the table name either inside of __backticks__ (the little used key in the top-left corner of your keyboard, under the __tilde__ sign), __`__

Examples:

    SELECT `Item Cost` FROM leso

This will also work:

    SELECT leso.`Item Cost` FROM leso

And this if you really want to be explicit about table names:

    SELECT `leso`.`Item Cost` FROM leso



~~~sql
SELECT county_ansi.state, county_ansi.county, 
      AGE775213 as senior_pop, county_boundaries.geometry
  FROM county_ansi
  INNER JOIN census_quickfacts
     ON county_ansi.fips = census_quickfacts.fips
  INNER JOIN county_boundaries 
     ON county_ansi.fips = county_boundaries.fips 
~~~

Exporting the result of this table to Fusion Tables creates a map like this:

<iframe width="600" height="400" scrolling="no" frameborder="no" src="https://www.google.com/fusiontables/embedviz?q=select+col3+from+1ro2kxgzG1uCxGQSZQcEwTYZRrKlVfDvKUmAA66MY&amp;viz=MAP&amp;h=false&amp;lat=29.7818091019233&amp;lng=-82.91538096352093&amp;t=1&amp;z=6&amp;l=col3&amp;y=2&amp;tmplt=2&amp;hml=GEOCODABLE"></iframe>

[See the Fusion Table here](https://www.google.com/fusiontables/data?docid=1ro2kxgzG1uCxGQSZQcEwTYZRrKlVfDvKUmAA66MY#rows:id=1).



##### Deriving a column totaling the LESO acquisition costs

The `leso` table includes a `Quantity` column and an `Acquisition Cost`. If you want to find the __total cost__ per line item, then you need a column in which `Quantity` is multiplied by `Acquisition Cost`:

~~~sql
SELECT `Item Name`, UI, Quantity,`Acquisition Cost`, 
  (Quantity * `Acquisition Cost`) AS totes_cost
  FROM leso
  ORDER BY Quantity DESC
  LIMIT 10
~~~

|----------------------------|-------|----------|------------------|------------|
|         Item Name          |   UI  | Quantity | Acquisition Cost | totes_cost |
|----------------------------|-------|----------|------------------|------------|
| WIRE,ELECTRICAL            | Foot  |    91000 |             0.58 |   52780.00 |
| SCREW,CAP,SOCKET HEAD      | Each  |    43822 |             0.23 |   10079.06 |
| MAGAZINE,CARTRIDGE         | Each  |    40000 |             9.31 |  372400.02 |
| BANDAGE KIT,ELASTIC        | EA    |    22428 |             7.00 |  156996.00 |
| CPCV BRASS                 | LB    |    21100 |             1.00 |   21100.00 |
| PANELING MATERIAL,BUILDING | Pound |    10000 |             1.57 |   15700.00 |
| MAGAZINE,CARTRIDGE         | Each  |     9415 |             9.31 |   87653.65 |
| BUTTSTOCK,SUBASSEMBLY      | Each  |     9000 |            15.03 |  135270.00 |
| 5 56 EXPENDED BALL BRASS   | LB    |     7700 |             1.00 |    7700.00 |
| DRESSING,COMPRESSION       | Each  |     7545 |            10.15 |   76581.75 |
{: .sql-table}


If you want, you can __create__ a new column named `totes_cost`, specify it as an `INT`/`INTEGER` or `FLOAT`/`DECIMAL` and then __update__ it with the calculation:

~~~sql
UPDATE leso
  SET totes_cost = (Quantity * `Acquisition Cost`);
~~~

This way, you don't have to keep doing the multiplication for every query.



##### What categories of military surplus aren't being distributed?

Not every kind of military surplus is requested or eligible to be shipped out to your local police department. To find out which, do a `LEFT JOIN` from the `psc` to the `leso` table:

~~~sql
SELECT psc.`PSC CODE`, 
    psc.`PRODUCT AND SERVICE CODE FULL NAME`,  
    psc.`PRODUCT AND SERVICE CODE NOTES`, 
    psc.`PRODUCT AND SERVICE CODE INICLUDES`
  FROM psc
  LEFT JOIN leso
  ON psc.`psc code` = leso.psc_code
  WHERE leso.psc_code IS NULL
  /* include only PSC Codes that are 4 characters long */
  AND LENGTH(psc.`PSC CODE`) = 4 
~~~

Apparently, nuclear bombs and flamethrowers are not yet eligible to be acquired through the 1033 Program:

|----------|----------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------|
| PSC CODE |                        PRODUCT AND SERVICE CODE FULL NAME                        |                                                                         PRODUCT AND SERVICE CODE NOTES                                                                         |                                              PRODUCT AND SERVICE CODE INICLUDES                                             |
|----------|----------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------|
|     1025 | Guns, over 150 mm through 200 mm Includes Firing Platforms; Mounts; Gun Shields. |                                                                                                                                                                                |                                                                                                                             |
|     1030 | Guns, over 200 mm through 300 mm Includes Gun Yokes; Rammers; Reflectors.        |                                                                                                                                                                                |                                                                                                                             |
|     1035 | Guns, over 300 mm                                                                |                                                                                                                                                                                | Breech Mechanisms; Training Gears; Power Drives.                                                                            |
|     1040 | Chemical Weapons and Equipment                                                   |                                                                                                                                                                                | Flame Throwers; Smoke Generators.                                                                                           |
|     1045 | Launchers, Torpedo and Depth Charge                                              |                                                                                                                                                                                | Depth Charge Tracks; Torpedo Tubes.                                                                                         |
|     1055 | Launchers, Rocket and Pyrotechnic                                                |                                                                                                                                                                                | Airborne Rocket Launchers adaptable to guided missile use.                                                                  |
|     1070 | Nets and Booms, Ordnance                                                         | This class includes nets and booms for harbor  defense only.                                                                                                                   |                                                                                                                             |
|     1075 | Degaussing and Mine Sweeping Equipment                                           |                                                                                                                                                                                |                                                                                                                             |
|     1105 | Nuclear Bombs                                                                    | This class includes nuclear weapons (including bombs), which are designed to be dropped from an aircraft.                                                                      | Ballistic cases, tail assemblies, retardation devices, and other peculiar components which are not  classifiable elsewhere. |
|     1110 | Nuclear Projectiles                                                              | This class includes nuclear weapons which are designed to be propelled from a recoilless rifle, gun,  howitzer, or the like, and which are not designed to be  self propelled. | Ogive sections, body sections, bases, and other peculiar components which are not classifiable elsewhere.                   |
{: .sql-table}




### Midterm questions

For __all of these questions__, besides giving the answer, please __include the SQL quer(ies)__ and other spreadsheet/data steps you took to get to the answer.


1. Query the database and create a list of every county (with state) that has __acquired at least one mine-resistant armored vehicle__. Then __map that list__ (Fusion Tables will probably be the easiest method). The map but not exactly the same, as the list behind this [NYT interactive map of armored vehicles](http://www.nytimes.com/interactive/2014/08/15/us/surplus-military-equipment-map.html?smid=pl-share).
2. Query the database and find the most expensive _single_ item that can be acquired through the 1033 program. Then generate a list of all counties that has so far acquired at least one of these things (you'll likely do two queries to answer this question).
3. Query the database to get the __top 10 counties__ ordered by __the total number of guns acquired__ through the 1033 program. Your answer should look [very similar to what NPR found under](http://www.npr.org/2014/09/02/342494225/mraps-and-bayonets-what-we-know-about-the-pentagons-1033-program) the __Total Guns Acquired__ graph (e.g. 3,452 guns for Los Angeles)
4. Query the database to get the __top 10 counties__ ordered by __number of guns acquired per 1,000 people__ using the Census's __2013 population estimate__. Again, your answers should look similar (but not exact) [to what NPR found](http://www.npr.org/2014/09/02/342494225/mraps-and-bayonets-what-we-know-about-the-pentagons-1033-program), e.g. 28 guns/1,000 people in Franklin, KY.
5. Create a time-series/[histogram](http://en.wikipedia.org/wiki/Histogram) showing _something you find interesting_ in the 1033 Program data. Examples: Number of gas masks versus night-goggles distributed by year. Monetary value of pants and trousers versus rifles, by year.
6. Find __all of the counties__ that have not acquired a single thing in the `leso` table, __and then map those counties__. If you order your list by population, the top two counties should be Kings County and Bronx County in New York (for reasons that should make sense if you have lived in New York).
7. Find the county that has acquired the most from the 1033 Program in terms of __total acquisition cost__ and generate a list of the items that county has acquired.
8. Write a __300-word story memo__ on an __interesting query (or queries)__ of your own. The memo should include examples/results of a data query and why you think said results are __newsworthy__ or worth further investigation. Your memo, ideally, would involve some additional research to see if anyone else has found anything related to your inquiry. A chart/graphic is optional.

    Example story ideas:

    - Finding the smallest counties (by population) that have acquired the most heavy equipment despite no obvious need for such equipment. Is that equipment in use, and how? What is the maintenance and training cost of the equipment?
    - Which counties have acquired a high amount of surplus equipment in earlier years (2006 to 2007) but very little, or none at all, in recent years?
    - What kinds of equipment have only recently been distributed through the 1033 Program, but are currently in seemingly high demand?
    - What are the surplus items that have no acquisition cost? And is the lack of cost consistent across _all_ records of those items (and similar items)? Is the lack of cost because of sloppy data entry? Or because of the type of item?



Submit the answers to these questions, including all relevant queries, links, screenshots, etc., as a Markdown file named __midterm.md__ in your private Github repo.
